分布式任务调度的基础知识。## 什么是任务调度器？一个任务是一段需要资源（CPU 时间，内存，存储，网络带宽等）的计算工作，持续一段指定的时间。例如，在Facebook或Instagram上上传照片或视频需要进行以下后台任务：1.编码照片或视频的多个分辨率。2. 验证照片或视频以检测内容赚钱版权等等。（内容赚钱：内容赚钱是一种利用内容的方式，以便服务可以在用户消费内容时从中获利。）所有以上任务的成功执行使照片或视频可见。但照片和视频的上传者不需要停止上述任务以完成工作。另一个例子是我们在Facebook上发表评论。我们不需要等到该评论进行传递到所有粉丝之后才发布该评论。这一交付被委派给异步任务调度程序进行离线处理。在系统中，许多任务争夺有限的计算资源。通过智能地将资源分配给任务以满足任务级和系统级目标的系统称为任务调度程序。## 何时使用任务调度器任务调度器是有效地完成工作的关键组件。它允许我们使用有限的资源完成大量的任务。它还有助于充分利用系统资源，为用户提供不间断的执行体验等等。以下是任务调度的一些用例：(不间断执行体验：周期性运行任务，而不需要用户干预重新开始任务执行。)- 单操作系统节点：它具有许多进程或任务争夺节点有限的计算资源。因此，我们可以使用本地OS任务调度程序来有效地为任务分配资源。它使用多反馈队列来选择某些任务并在某些处理器上运行它们。- 云计算服务：在这些服务中，有许多分布式资源和来自多个租户的各种任务，需要一个任务调度程序来高效地利用云计算资源并满足租户的需求。本地OS任务调度程序对于此目的不足，因为任务数量可能达到数十亿，任务的来源不是单一的，需要管理的资源不在一台机器上。我们必须采用分布式解决方案。- 大型分布式系统：在这个系统中，许多任务针对单个用户的单个请求在后台运行。考虑像Facebook，WhatsApp或Instagram这样的流行系统拥有数以亿计的用户。这些系统需要一个任务调度程序来处理数十亿个任务。Facebook使用Async调度其用户数以亿计的并行异步请求产生的所有任务。(异步请求：不属于客户端关键路径的请求，通常存在一定的延迟容忍度。用户请求这些任务，而系统在请求者无需等待工作完成的情况下完成任务。将来一些时间向请求者通报任务的最终状态。）>**注意**：Async是Facebook自己的分布式任务调度程序，用于调度所有其任务。某些任务更加时间敏感，例如应在事件的直播开始时运行的任务通知用户。如果用户在直播结束后收到有关直播的通知，那将是没有意义的。某些任务可以延迟，例如向用户提供好友建议的任务。Async根据适当的优先级安排任务。## 分布式任务调度决定并及时分配资源到任务的过程被称为**任务调度**。以下图示展示了操作系统级任务调度器和数据中心级任务调度器之间的视觉差异：![QQ截图20230410140945](/img/23-Distributed%20Task%20Scheduler/QQ%E6%88%AA%E5%9B%BE20230410140945.png)操作系统级任务调度器与数据中心级任务调度器数据中心任务调度器会管理来自多个租户使用数据中心资源的数十亿个任务，而操作系统级任务调度器则在节点的计算资源上调度节点上本地的任务或进程。我们的目标是设计一个类似于数据中心级任务调度器的任务调度器，需要考虑以下事项：- 任务将来自许多不同的源、租户和子系统。- 许多资源将分散在数据中心中（或者可能分散在多个数据中心中）。以上两个要求使任务调度问题具有挑战性。我们将设计一个分布式任务调度器，通过使其具有可扩展性、可靠性和容错性来处理所有这些任务。## 我们将如何设计一个任务调度系统？我们将任务调度器的设计划分为四个部分：1. **需求：** 本课程将确定任务调度系统的功能和非功能需求。2. **设计：** 本课程将讨论我们任务调度系统的系统设计以及探讨系统和数据库模式的组件。3. **设计考虑因素：** 本课程将强调一些设计因素，如任务优先级、资源优化等。4. **评估：** 我们将根据我们的需求评估我们的任务调度器设计。让我们从了解任务调度系统的需求开始。