# 资源估算样例
现在，我们已经打好了资源估算的基础，让我们利用我们的背景知识来估算诸如服务器、存储和带宽等资源。下面，我们考虑一个场景和一个服务，做出假设，并基于这些假设来进行估算。让我们一起来看看！

## 需要的服务器数量
关于类似 Twitter 服务的资源，让我们做出以下假设。

**假设：**
- 每天有 5 亿个（M）活跃用户（DAU）。
- 平均每个用户每天进行 20 次请求。
- 注意，单个服务器可以处理 8000 RPS。

<h4 align = "center">服务器数量的估算</h4>

![搜狗截图20230406180650](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406180650.png)
<center>展示详细的计算方法</center>

![搜狗截图20230406182708](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182708.png)

事实上，上面的数字似乎不正确。如果我们只需要 15 台普通服务器来服务每天的 5 亿用户，那么为什么大型服务会在数据中心中使用数百万台服务器呢？这主要原因是 RPS 不足以估算提供服务所需的服务器数量。此外，我们在上述计算中作出了一些基本假设。其中一个假设是请求只由一个服务器处理。现实中，请求通过 web 服务器，可能与应用服务器进行交互，这些应用服务器可能还从存储服务器请求数据。每台服务器处理每个请求的时间可能不同。此外，根据数据中心、应用和请求本身的状态，每个请求的处理方式可能不同。请记住，我们有各种服务器来提供数据中心内的各种服务。

我们已经确定了：

1.由于许多因素（如每个服务设计不同、具有不同的扇出规则和硬件、服务器职责随时间改变等），找到准确的容量估算是具有挑战性的。

2.在设计层面上，粗略的估计是适当的，因为目的是得出所需资源的合理上限。我们还可以使用队列论和运营研究的先进方法来做出更好的估计。然而，在面试或初始设计阶段使用这种策略是不适当的。实际系统使用各种方法（包括后期调试的估算方法、模拟、原型和监控）逐步改进其初始（可能粗略的）估算。

因此，我们通过描述服务器在某一天处理的客户端数量来近似服务器数量：

![搜狗截图20230406182725](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182725.png)

为了更好地近似，让我们使用以下两个假设：

1.我们假设该服务的每个活跃用户（DAU）一天只发送一次请求。

![搜狗截图20230406182741](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182741.png)

2.我们假设有一个特定的时间，所有用户的所有请求同时到达服务。我们将使用它来得到峰值负载的容量估算。要做得更好，我们需要请求和响应分布，这可能在原型级别上可用。我们可能会假设分布遵循某种特定类型的分布，例如泊松分布。通过使用 DAU 作为特定秒的峰值负载的代理，我们避免了找到请求和响应到达速率的困难。

因此，DAU 将成为每秒请求的数量。我们已经有了服务器的 RPS；因此，方程式（1）变为：

![搜狗截图20230406182749](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182749.png)

通过在上述公式中插入数值，我们得出以下服务器数量：![搜狗截图20230406182802](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182802.png)<center>一个类似Twitter的服务所需的服务器数量</center>> **注意：**我们的计算基于可能不会给我们服务器数量的严格边界的近似，但仍然是现实的。因此，我们在设计问题的估算服务器数量中使用这种方法。简单来说，上面给出的方程假设一个服务器每秒可以处理8,000个用户。我们在本课程的其余部分中也使用这个参考值。## 存储要求在这一部分中，我们试图使用Twitter作为例子来了解如何进行存储估算。我们估算Twitter在一年内发布新推文所需的存储空间量。让我们先做出以下假设：- 我们拥有总计2.5亿日活跃用户。- 每个用户每天发布三条推文。- 推文中有10%包含图片，而5%的推文包含视频。任何包含视频的推文不会包含图片，反之亦然。- 假设平均每张图片大小为200 KB，视频大小为3 MB。- 推文文字及其元数据需要数据库中的总共250字节存储。那么，将需要以下存储空间：<h4 align = "center">估算存储要求</h4> ![搜狗截图20230406180846](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406180846.png)<center>显示详细计算</center>![搜狗截图20230406182839](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182839.png)> ![搜狗截图20230406183718](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406183718.png)![搜狗截图20230406180903](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406180903.png)<center>Twitter一年所需的总存储空间</center>## 带宽需求为了估算服务的带宽需求，我们采用以下步骤：1. 估算服务每天收到的数据量。2. 估算服务每天发送的数据量。3. 通过将收入和支出数据除以一天的秒数来估算以Gbps（每秒十亿位）为单位的带宽。**收入流量：** 让我们从Twitter的先前示例继续，该示例每天需要128 TB的存储空间。因此，每秒钟的入站流量应支持以下带宽：![搜狗截图20230406182849](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182849.png)> **注意：**我们乘以8以将字节（B）转换为位（b），因为带宽以每秒位数来衡量。**出站流量：** 假设单个用户每天查看50条推文。考虑到视频和图片的比率仍为5％和10％，对于这50条推文，有2.5条将包含视频内容，而5条将包含图片。考虑到每天有2.5亿活跃用户，我们得出以下估算：#### 估算带宽需求![搜狗截图20230406180916](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406180916.png)显示详细计算![搜狗截图20230406182918](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406182918.png)![搜狗截图20230406184302](/img/05-Back-of-the-envelope Calculations/搜狗截图20230406184302.png)Twitter需要的总带宽