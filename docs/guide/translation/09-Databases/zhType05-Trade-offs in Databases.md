# 数据库权衡

了解何时使用水平切分而不是垂直切分，反之亦然。

## 哪种数据库分片方法最好？

水平切分和垂直切分都涉及向我们的计算基础架构添加资源。我们的业务利益相关者必须决定哪种适合我们的组织。我们必须相应地扩大我们的资源，以使我们的组织和业务增长，以防止停机时间并减少延迟。我们可以通过调整CPU、物理内存要求、硬盘调整和网络带宽的组合来扩展这些资源。

以下部分解释了无切片与切片优缺点。

### 集中式数据库的优缺点

#### 优点

- 数据维护（如更新和备份集中式数据库）很容易。

- 集中式数据库比分布式数据库提供更强的一致性和ACID事务。

- 集中式数据库相比分布式数据库为端程序员提供了更简单的编程模型。

- 对于需要存储在单个节点上并且可以存储的少量数据的企业来说，这更加高效。

#### 缺点

- 当每秒查询访问集中式数据库的数量接近单节点限制时，集中式数据库可能会变慢，从而导致端用户高延迟。

- 集中式数据库具有单个故障点。因此，它不可访问的概率更高。

### 分布式数据库的优缺点

#### 优点

- 访问分布式数据库中的数据非常快捷，因为数据是从最近的数据库碎片或经常使用的数据库碎片中检索的。

- 具有不同分布透明度级别的数据可以存储在不同的位置。

- 由查询组成的密集事务可以分成多个优化的子查询，这些子查询可以并行处理。

#### 缺点

- 有时需要从多个站点检索数据，这比预期的时间更长。

- 关系在不同节点之间垂直或水平划分。因此，在仔细获取数据时需要重新构建完整的关系，如联接等操作。这些操作可能变得更加昂贵和复杂。

- 在分布式数据库中维护数据的一致性很困难，并且需要采取额外的措施。

- 分布式数据库中的更新和备份需要时间来同步数据。

### 分布式数据库中的查询优化和处理速度

分布式数据库中的事务取决于查询类型、涉及的站点（碎片）数量、通信速度和其他因素，例如底层硬件和使用的数据库类型。但是，作为一个例子，让我们假设一个查询访问三个表，`Store`，`Product`和`Sales`，这些表驻留在不同的站点上。

每个表中的属性数如下图所示：

![QQ截图20230407115228](/img/09-Databases/QQ截图20230407115228.png)

由三个表`Store`、`Product`和`Sales`组成的数据库模式

让我们假设在不同站点上对这两个表进行分布如下：

- `Store`表有10,000个存储在A站点的元组。

- `Product`表有100,000个存储在B站点的元组。

- `Sales`表有1,000,000个存储在A站点的元组。

现在，假设我们需要处理以下查询：

```
sqlSelect Store_key from (Store JOIN Sales JOIN Product)where Region= 'East' AND Brand='Wolf';
```

上述查询在`Store`、`Sales`和`Product`表上执行联接操作，并从联接操作结果生成的表中检索`Store_key`值。

接下来，假设每个存储的元组长度为200位。即相当于25个字节。此外，某些中间结果的预估基数如下：

- `Wolf`品牌的数量为10。

- `East`地区的商店数量为100,000。

通信假设如下：
- 数据传输速率==50M每秒
- 访问延迟==0.1秒

#### 参数假设
![QQ截图20230407115248](/img/09-Databases/QQ截图20230407115248.png)

#### 可能的方法
![QQ截图20230407115258](/img/09-Databases/QQ截图20230407115258.png)

当我们比较这三种方法时，第三种方法提供了最少的延迟（0.1秒）。这个例子表明，在分布式数据库中，仔细的查询优化也是至关重要的。

### 结论
考虑到查询已经被优化，数据垂直和水平分片分布在多个节点上旨在提高以下功能：
- 可靠性（容错性）
- 性能
- 平衡存储容量和成本

集中式和分布式数据库都有它们的优缺点。我们应该根据应用程序的需要来选择它们。